
## 需求文档 (Product Requirements Document)

### 1\. 项目概述

  * **插件名称**: FJNote 助手
  * **目标**: 为 Blinko 笔记服务开发一款 astrbot (QQ) 插件，提供一个流畅、高效的聊天式界面，用于快速记录“闪念”和管理“ToDo”任务。
  * **核心理念**:
      * **闪念优先**: 任何非指令的私聊消息都应被视为闪念的一部分，降低记录心智负担。
      * **对话式记录**: 支持在连续对话中记录一条完整的闪念，通过30秒无新消息的间隔来自动确认闪念完成。
      * **指令驱动任务**: 使用简洁的 `#` 符号指令体系，清晰地管理 ToDo 任务。
      * **优雅展示**: 复杂列表和信息的反馈将通过渲染精美的 HTML 图片呈现，避免在聊天窗口刷屏。

### 2\. 核心功能

#### 2.1. 闪念 (Flash Notes)

  * **自动合并记录**:
      * 用户向机器人私聊发送第一条消息（文本/图片/文件）后，启动一个30秒的计时器。
      * 在30秒内，用户发送的所有后续消息都将被追加到当前“闪念会话”中。每条新消息都会重置计时器。
      * 如果计时器走完（30秒内无新消息），系统会将“闪念会話”中的所有内容合并为一条闪念，并调用 Blinko API 进行存储。
      * 用户可以在任何消息中通过 `#标签` 的形式为这条闪念添加标签。
  * **多媒体支持**: 支持记录文本、QQ图片、文件。机器人需要将图片和文件先上传至 Blinko，再将返回的链接或标识符存入笔记内容中。
  * **反馈机制**:
      * 开始记录时，无反馈，避免打扰。
      * 合并完成后，发送一条确认消息，如：“⚡️ 闪念已记录，并添加了标签：【日常, 心情记录】”。

#### 2.2. ToDo 管理

  * **统一语法**: 所有 ToDo 操作均通过 `#指令` 驱动。
  * **功能列表**:
      * **添加 (`#todo`)**: 创建一个新的待办事项，可指定 `#分类` 和 `~截止日期`。
      * **列表 (`#list`)**: 查看待办事项，可按分类查看，或查看所有（包括已完成）。
      * **完成 (`#done`)**: 将一个或多个待办事项标记为完成。
      * **删除 (`#del` / `#rm`)**: 删除一个或多个待办事项。
      * **编辑 (`#edit`)**: 修改一个待办事项的内容或分类。

#### 2.3. 查找与管理

  * **全局搜索 (`#find` / `#search`)**: 根据关键词或 `#标签` 在所有笔记（闪念和ToDo）中搜索。
  * **标签管理 (`#tags` / `#cats`)**:
      * 查看所有已创建的标签/分类及其使用频率。
      * 支持重命名标签 (`#tags rename`)。

#### 2.4. 帮助

  * **帮助文档 (`#help`)**: 显示一个包含所有指令和用法的帮助信息图片。

### 3\. 界面与交互 (UI & Interaction)

  * **输入**:
      * 用户通过 QQ 私聊窗口发送文本、图片、文件。
      * 使用 `#` 作为指令和标签/分类的统一前缀。
      * 使用 `~` 作为 ToDo 截止日期的前缀。
  * **输出/展示**:
      * 简单的确认消息（如闪念记录、ToDo 添加/删除成功）使用纯文本回复。
      * 复杂的列表信息（如 `#list`, `#find`, `#tags`, `#help` 的结果）将使用 Jinja2 模板引擎生成结构化的 HTML，然后转换为图片发送给用户。
      * **图片模板设计 (示例)**:
          * **ToDo 列表 (`#list`)**:
              * 标题: "📝 ToDo 列表 - [分类名]"
              * 内容: 按分类组织，每个 ToDo 前有唯一的数字编号和复选框（未完成为 ☐, 已完成为 ☑）。
              * 格式: `[编号] ☐ [任务内容] ~[截止日期]`
          * **搜索结果 (`#find`)**:
              * 标题: "🔍 搜索结果 - [关键词]"
              * 内容: 分“闪念”和“ToDo”两个区域展示，每条结果前显示日期和内容摘要。
          * **帮助 (`#help`)**:
              * 设计成一个美观、易读的指令说明图。